# ๐ ุฎุฑูุทุฉ ุงูุจููุฉ ุงูุฌุฏูุฏุฉ

## ุงููููุงุช ุงูุฌุฏูุฏุฉ ุงููุถุงูุฉ

```
elia-ecom-frontend/
โ
โโโ ๐ AUTH_SYSTEM_GUIDE.md          โ ุฏููู ุงููุธุงู ุงูุดุงูู
โโโ ๐ TOKEN_FIX_GUIDE.md            โ ุดุฑุญ ุงูุฅุตูุงุญุงุช ุงูุชูุตููู
โโโ ๐ TROUBLESHOOTING_AUTH.md       โ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก
โโโ ๐ SUMMARY.md                    โ ุงูููุฎุต ุงูููุงุฆู
โโโ ๐ QUICK_START.md                โ ุงูุจุฏุก ุงูุณุฑูุน
โโโ ๐ ARCHITECTURE.md               โ ูุฐุง ุงูููู
โ
โโโ lib/
โ   โโโ axios.js                     โ ูุนุฏู (ุชุญุณูู Interceptor)
โ   โโโ ๐ auth-debug.js             โ ุฌุฏูุฏ (ุฃุฏูุงุช Console)
โ   โโโ ๐ auth-helper.js            โ ุฌุฏูุฏ (ุฏูุงู ูุณุงุนุฏุฉ)
โ   โโโ ๐ use-auth.js               โ ุฌุฏูุฏ (Hooks ูุงูุญูุงูุฉ)
โ   โโโ constants.js
โ
โโโ components/
โ   โโโ Providers.js                 โ ูุนุฏู (ุชุถููู auth-debug)
โ   โโโ Header.js
โ   โโโ Footer.js
โ   โโโ Navbar.js
โ   โโโ ModernSearch.js
โ   โโโ ProductCard.js
โ   โโโ AdminHeader.js
โ
โโโ app/
โ   โโโ page.js                      (ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ)
โ   โโโ layout.tsx
โ   โโโ globals.css
โ   โ
โ   โโโ login/
โ   โโโ register/
โ   โโโ profile/
โ   โ
โ   โโโ contact/
โ   โ   โโโ page.js                  โ ูุนุฏู (ุฅุถุงูุฉ ุงูุชุญูู)
โ   โ
โ   โโโ admin/
โ   โ   โโโ page.js                  โ ูุนุฏู (ุฅุถุงูุฉ ุงูุญูุงูุฉ)
โ   โ   โโโ products/
โ   โ   โโโ edit/
โ   โ   โโโ product/
โ   โ   โโโ user/
โ   โ   โโโ orders/
โ   โ   โโโ coupons/
โ   โ   โโโ notifications/
โ   โ   โโโ messages/
โ   โ   โโโ security/
โ   โ   โโโ settings/
โ   โ   โโโ stats/
โ   โ
โ   โโโ ๐ token-debug/              โ ุฌุฏูุฏ (ุตูุญุฉ ุงูุงุฎุชุจุงุฑ)
โ       โโโ page.js
โ
โโโ context/
โ   โโโ CartContext.js
โ
โโโ public/
```

---

## ๐ ุชุฏูู ุงูุนูู ุงูุฌุฏูุฏ

### ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู:
```
user โ /login โ API (/users/login)
                    โ
              returns accessToken
              + refreshToken
                    โ
              localStorage.setItem('userInfo')
                    โ
              redirect to /admin or /
```

### ุนูุฏ ุทูุจ API:
```
ุฃู ุตูุญุฉ โ axios.post(...) โ Interceptor
              โ
        ุฃุถู Authorization header
              โ
        ุฃุฑุณู ุงูุทูุจ
              โ
        โโโโ status 200 โ โโโโ
        โ                     โ
       ูุนู                   401
        โ                     โ
        โผ                     โผ
   ุงุณุชูุจู ุงูุฑุฏ         ุญุงูู ุชุญุฏูุซ ุงูุฌูุณุฉ
        โ                     โ
        โโโโโโโโฌโโโโโโโโโโโโโโโค
               โ              โ
        ุฅุนุงุฏุฉ ูุญุงููุฉ ุงูุทูุจ  โโโ
               โ
        โโโโ ูุฌุญ โ โโโโ
        โ              โ
       ูุนู            ูุง
        โ              โ
        โผ              โผ
   ุงุณุชูุจู ุงูุฑุฏ   ูุฌู ููู login
```

---

## ๐ฏ ูุณุงุฑุงุช ุงููุตูู ุงูุฌุฏูุฏุฉ

### ูููุณุชุฎุฏููู ุงูุนุงุฏููู:
- `GET /` - ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
- `POST /contact` - ุฅุฑุณุงู ุฑุณุงูุฉ (ูุชุทูุจ ุชุณุฌูู ุฏุฎูู)
- `GET /profile` - ููู ุงููุณุชุฎุฏู (ูุชุทูุจ ุชุณุฌูู ุฏุฎูู)

### ููู Admins:
- `GET /admin` - ููุญุฉ ุงูุชุญูู (ูุชุทูุจ role='admin')
- `GET /admin/products` - ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช
- `GET /admin/orders` - ุฅุฏุงุฑุฉ ุงูุทูุจุงุช
- `GET /admin/users` - ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู
- `GET /admin/messages` - ุฑุณุงุฆู ุงููุณุชุฎุฏููู

### ูููุทูุฑูู:
- `GET /token-debug` - ุตูุญุฉ ุงุฎุชุจุงุฑ ุงูุชููู ูุงูุฌูุณุงุช

---

## ๐ ุทุจูุงุช ุงูุญูุงูุฉ

### ูุณุชูู 1: ุนุฏู ูุฌูุฏ ุชุณุฌูู ุฏุฎูู
```javascript
if (!isValidSession()) {
  redirect('/login');
}
```

### ูุณุชูู 2: ุฏูุฑ ูุญุฏุฏ
```javascript
const user = getCurrentUser();
if (user.role !== 'admin') {
  redirect('/');
}
```

### ูุณุชูู 3: Interceptor ุชููุงุฆู
```javascript
// ุฅุฐุง ุงูุชูุช ุงูุฌูุณุฉ:
// 1. ุฌุฑุจ ุชุญุฏูุซ ุงูุชููู ุชููุงุฆูุงู
// 2. ุฅุฐุง ูุฌุญ โ ุฃุนุฏ ุงูุทูุจ
// 3. ุฅุฐุง ูุดู โ ูุฌู ูููุฌู
```

---

## ๐ ุญุงูุงุช ุงููุณุชุฎุฏู ุงูููููุฉ

### ุงูุญุงูุฉ 1: ูู ูุณุฌู ุฏุฎูู
```javascript
{
  isLoggedIn: false,
  user: null,
  token: null,
  role: null
}
```

### ุงูุญุงูุฉ 2: ูุณุชุฎุฏู ุนุงุฏู
```javascript
{
  isLoggedIn: true,
  user: {
    id: "123",
    email: "user@example.com",
    name: "Ahmed",
    role: "user"
  },
  token: "eyJhbGci...",
  hasToken: true
}
```

### ุงูุญุงูุฉ 3: ูุณุชุฎุฏู Admin
```javascript
{
  isLoggedIn: true,
  user: {
    id: "456",
    email: "admin@example.com",
    name: "Admin User",
    role: "admin"
  },
  token: "eyJhbGci...",
  hasToken: true
}
```

---

## โก ุชุญุณููุงุช ุงูุฃุฏุงุก

### ูุจู ุงูุฅุตูุงุญ:
- 401 Error โ ููุฏุงู ุงูุฌูุณุฉ โ redirect โ
- ุงูุทูุจ ููุดู โ
- ูุฌุจ ุชุณุฌูู ุฏุฎูู ูุฏูู โ

### ุจุนุฏ ุงูุฅุตูุงุญ:
- 401 Error โ ุชุญุฏูุซ ุชููุงุฆู โ
- ุงูุทูุจ ูุนุงุฏ ุชููุงุฆูุงู โ
- ุงููุณุชุฎุฏู ูุง ููุงุญุธ ุดูุก โ

---

## ๐งฉ ุงูููููุงุช ุงูุฑุฆูุณูุฉ

### 1. Axios Interceptor
```javascript
// lib/axios.js
- Request Interceptor: ุฅุถุงูุฉ ุงูุชููู
- Response Interceptor: ูุนุงูุฌุฉ 401 ูุชุญุฏูุซ ุงูุชููู
```

### 2. ุฃุฏูุงุช ุงูุชุตุญูุญ
```javascript
// lib/auth-debug.js
window.authDebug.showTokenInfo()
window.authDebug.expireToken()
window.authDebug.clearAllData()
```

### 3. ุฏูุงู ูุณุงุนุฏุฉ
```javascript
// lib/auth-helper.js
isValidSession()      // ุงูุชุญูู ูู ุงูุฌูุณุฉ
getCurrentUser()      // ุจูุงูุงุช ุงููุณุชุฎุฏู
getToken()            // ุงูุญุตูู ุนูู ุงูุชููู
handleAuthError()     // ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
```

### 4. Hooks
```javascript
// lib/use-auth.js
useAuth()             // Hook ูููุตุงุฏูุฉ
ProtectRoute          // ูููู ูุญูุงูุฉ ุงูุตูุญุงุช
```

### 5. ุตูุญุฉ ุงูุงุฎุชุจุงุฑ
```javascript
// app/token-debug/page.js
ูุงุฌูุฉ ุฑุณูููุฉ ูุงุฎุชุจุงุฑ:
- ุนุฑุถ ูุนูููุงุช ุงูุชููู
- ูุญุงูุงุฉ ุงูุชูุงุก ุงูุฌูุณุฉ
- ุงุฎุชุจุงุฑ ุงูุชุญุฏูุซ ุงูุชููุงุฆู
```

---

## ๐ ููุงุท ุงูุชูุงูู ุงูุฑุฆูุณูุฉ

### ูุน ุงูุจูุงู ุฅูุฏ:
```
GET /users/profile          โ ุจูุงูุงุช ุงููุณุชุฎุฏู
POST /users/login           โ ุชุณุฌูู ุงูุฏุฎูู (ูุฑุณู accessToken + refreshToken)
POST /users/refresh-token   โ ุชุญุฏูุซ ุงูุฌูุณุฉ (ูุณุชูุจู refreshTokenุ ูุฑุณู accessToken)
```

### ูุน ุงูููุชุจุงุช:
```
axios              โ ุทูุจุงุช API
react-toastify    โ ุฅุธูุงุฑ ุงูุฑุณุงุฆู
next/navigation   โ ุงูุชููู ุจูู ุงูุตูุญุงุช
```

---

## ๐ ูุฎุทุท ุงูุญุงูุงุช

```
[ูุณุชุฎุฏู ุฌุฏูุฏ]
      โ
      โผ
[ุตูุญุฉ Login] โ /users/login โ [ุชุฎุฒูู ุงูุชููู]
      โ
      โโ ูุฌุญ โ โ [redirect to /admin]
      โ
      โโ ูุดู โ โ [ุนุฑุถ ุฑุณุงูุฉ ุฎุทุฃ]

[ูุณุชุฎุฏู ูุณุฌู ุฏุฎูู]
      โ
      โโ ููุชุญ ุตูุญุฉ ุนุงุฏูุฉ โ
      โ
      โโ ููุชุญ ุตูุญุฉ ูุญููุฉ
      โ   โโ check isValidSession()
      โ      โโ ูุนู โ โ ุนุฑุถ ุงูุตูุญุฉ
      โ      โโ ูุง โ โ redirect to /login
      โ
      โโ ูุฑุณู ุทูุจ API
      โ   โโ ูุถุน ุงูุชููู ูู Headers
      โ      โโ Server ุชุฑุฏ
      โ         โโ 200 โ โ ูุฌุญ
      โ         โโ 401 โ๏ธ โ ุชุญุฏูุซ ูุฅุนุงุฏุฉ ูุญุงููุฉ
      โ
      โโ ูุถุบุท Logout โ ูุณุญ localStorage
```

---

## ๐ ููุงุญุธุงุช ุชูููุฉ

### localStorage keys:
```javascript
{
  "userInfo": {
    "id": "123",
    "email": "user@example.com",
    "name": "User Name",
    "role": "user",
    "accessToken": "eyJhbGci...",
    "refreshToken": "eyJhbGci...",
    "token": "eyJhbGci..."  // ูุณุฎุฉ ูู accessToken
  },
  "cart": [...]
}
```

### Header names:
```javascript
Authorization: "Bearer <token>"
x-auth-token: "<token>"
withCredentials: true
```

### Response Status Codes:
```javascript
200 โ OK                    - ุงูุทูุจ ูุฌุญ
201 โ Created              - ุงูุฅูุดุงุก ูุฌุญ
400 โ Bad Request          - ุจูุงูุงุช ุบูุฑ ุตุญูุญุฉ
401 โ Unauthorized         - ุฌูุณุฉ ููุชููุฉ
403 โ Forbidden            - ููุณ ูุฏูู ุตูุงุญูุฉ
404 โ Not Found            - ุงูููุฑุฏ ุบูุฑ ููุฌูุฏ
500 โ Internal Server Error - ุฎุทุฃ ูู ุงูุณูุฑูุฑ
```

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ

1. **ุงุฎุชุจุงุฑ ุงูุฌุฏูุฏ:**
   - ุชุณุฌูู ุฏุฎูู
   - ุงูุชุญ `/token-debug`
   - ุฌุฑุจ ูู ุงูุฃุฒุฑุงุฑ

2. **ุงูุชูุงูู ูุน ุงูุจูุงู ุฅูุฏ:**
   - ุชุฃูุฏ ูู endpoint `/users/refresh-token`
   - ุชุฃูุฏ ูู ุฅุฑุณุงู `refreshToken` ุนูุฏ Login
   - ุชุฃูุฏ ูู ุฅุฑุฌุงุน `accessToken` ูู ุงูุชุญุฏูุซ

3. **ุงุณุชุฎุฏุงู ูู ุงูุตูุญุงุช ุงูุฌุฏูุฏุฉ:**
   - ุงุณุชูุฑุฏ ุงูุฏูุงู ุงูููุงุณุจุฉ ูู `lib/auth-*`
   - ุงุณุชุฎุฏู ุงูุญูุงูุฉ ุงูููุงุณุจุฉ
   - ุงุฎุชุจุฑ ุฌูุฏุงู

---

**ุขุฎุฑ ุชุญุฏูุซ:** ูุธุงู ูุตุงุฏูุฉ ูุฌูุณุงุช ุดุงูู  
**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ููุฅุณุชุฎุฏุงู  
**ุงูุงุฎุชุจุงุฑ:** ูุชุทูุจ ุชุดุบูู ุงูุจูุงู ุฅูุฏ ุจุดูู ุตุญูุญ  
